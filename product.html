<!DOCTYPE html>
<html>
<head>
  <title>Product</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link rel="stylesheet" href="assets/style.css">
</head>
<body>

<div class="container amazon-product">

  <div class="amazon-images">
    <div class="amazon-thumbs" id="thumbs"></div>
    <div class="amazon-main" id="mainImage"></div>
  </div>

  <div>
    <h1 id="productName"></h1>
    <div class="price" id="productPrice"></div>
    <div class="amazon-stock">In stock</div>

    <div class="amazon-actions">
      <button class="btn-primary" onclick="addToCart()">Add to Cart</button>
      <button class="btn-secondary" onclick="buyNow()">Buy Now</button>
    </div>

    <p id="productDesc"></p>
  </div>

</div>

<script>
const API = "https://script.google.com/macros/s/AKfycbzuaL5BfyvFJVQ1AWCU7ZN8-LXehqbhjRhaItEtILJLwBC31K166aBP0W1mB2C_ngxe/exec";
const id = new URLSearchParams(location.search).get("id");
if (!id) location.href = "products.html";

let product;

fetch(API + "?action=product&id=" + id)
.then(r => r.json())
.then(p => {
  product = p;
  productName.innerText = p[1];
  productPrice.innerText = "â‚¹" + p[2];
  productDesc.innerText = p[3];

  const imgs = p[6].split(",");
  mainImage.innerHTML = `<img src="${imgs[0]}">`;
  thumbs.innerHTML = imgs.map(i =>
    `<img src="${i}" onclick="show('${i}')">`
  ).join("");
});

function show(src){
  mainImage.innerHTML = `<img src="${src}">`;
}

function addToCart(){
  sessionStorage.setItem("cart", JSON.stringify([product]));
  location.href = "cart.html";
}

function buyNow(){
  addToCart();
}
</script>

</body>
</html>
